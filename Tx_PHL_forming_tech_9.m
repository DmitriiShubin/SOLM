
modOut1 = step(hMod,IntrlvrOut_UL);

%clear IntrlvrOut
%{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Nsym = 16;           % Filter span in symbol durations
beta = 0.2;         % Roll-off factor
sampsPerSym = 4;    % Upsampling factor

H = comm.RaisedCosineTransmitFilter('FilterSpanInSymbols',Nsym,'OutputSamplesPerSymbol',sampsPerSym)

b = coeffs(H);
%H.Gain = 1/max(b.Numerator);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


yo_re = step(H,[real(modOut1); zeros(Nsym/2,1)]);
yo_im = step(H,[imag(modOut1); zeros(Nsym/2,1)]);
yo = yo_re + 1i*yo_im;
max1 = 0.7;
r = real(yo);
i = imag(yo);
%yo_r = r(r>max);
%yo_i = i(r>max);
%y0 = yo_i + yo_r*1i;
Data_reshaped = yo(31:end-2);
%}





Data_reshaped = zeros(size(modOut1,1)*number_s,1,'double');

a1 = ones(number_s,1,'double');
for i = 1:size(modOut1,1)
        Data_reshaped((1 + (i-1)*(number_s)): ((i*number_s))) = a1*modOut1(i);
end
%}

a1 = ones(number_s,1,'double');
LL_reshaped = zeros(size(IntrlvrOut_LL,1)*number_s,1,'double');
for i = 1:size(IntrlvrOut_LL,1)
        LL_reshaped((1 + (i-1)*(number_s)): ((i*number_s))) = a1*IntrlvrOut_LL(i);
end



%clear modOut_pilot_sof
%clear a1

Data_reshaped1 = reshape(Data_reshaped,[21600*number_s*3,numpackets/3]);



LL_reshaped1 = zeros(size(LL_reshaped,1),1,'double');
for i = 1:size(LL_reshaped,1)
if LL_reshaped(i) == 1
    LL_reshaped1(i) = 1.21;
else
    LL_reshaped1(i) = 0.725;
end
end


LL = reshape(LL_reshaped1,[64800*number_s,numpackets/3]);

%LL1 = zeros(size(LL,1),size(LL,2),'double');

%LL1(3:end,:) = LL(1:end-2,:);

%LL1(1:2,:) = LL(end-1:end,:);




modulated_reshaped = LL.*Data_reshaped1;
modulated = reshape(modulated_reshaped,[size(modulated_reshaped,1)*size(modulated_reshaped,2),1]);



%Pilot = zeros(36,1,'double');
%{
for i = 1:36*number_s
        Pilot((1 + (i-1)): i) = (0.707 + 0.7071i);
end
%}
number_pil = 64800/3/90/16; % number of pilots per frame




a = numpackets*number_pil;

buff = reshape(modulated,[1440*number_s,a]);
%clear modOut
Pilot = ones(36*number_s,size(buff,2),'double') * (0.707 + 0.7071i);

a = [buff;Pilot];
%clear buff
%clear Pilot

modOut_pilot = reshape(a,[size(a,1)*size(a,2),1]);
%clear a


sof = double([0 1 1 0 0 0 1 1 0 1 0 0 1 0 1 1 1 0 1 0 0 0 0 0 1 0]');%26 символов


sof = (sof*2 - 1)*(0.7 + 0.7i);

a1 = ones(number_s,1,'double');
sof_reshaped = zeros(size(sof,1)*number_s,1,'double');
for i = 1:size(sof,1)
        sof_reshaped((1 + (i-1)*(number_s)): ((i*number_s))) = a1*sof(i);
end




for i = 1:numpackets
    sof_m(:,i) = sof_reshaped;
end

%clear sof
buff = reshape(modOut_pilot,[22140*number_s,numpackets]);
%clear modOut_pilot
buff = [sof_m;buff];
%clear sof_m
modOut_pilot_sof = reshape(buff,[(22140+26)*numpackets*number_s,1]);
%clear buff
%{
modOut_pilot_sof = zeros(size(modOut_pilot,1)+numpackets*26,1);
for j = 1:numpackets

modOut_pilot_sof(1 + (j-1)*22166:j*22166) = [sof;modOut_pilot(1 + (j-1)*22140:j*22140)];
end


%}
%{
Data_reshaped = zeros(size(modOut_pilot_sof,1)*number_s,1,'double');
a1 = ones(number_s,1,'double');

for i = 1:size(modOut_pilot_sof,1)
        Data_reshaped((1 + (i-1)*(number_s)): ((i*number_s))) = a1*modOut_pilot_sof(i);
end

%clear modOut_pilot_sof
%clear a1
%}
Im = imag(modOut_pilot_sof);
Re = real(modOut_pilot_sof);

%clear Data_reshaped


rcTxFilt = double([1.27374921684735e-06 -5.24128095649087e-05 -5.95323428536631e-05 -1.30662921240797e-05 4.59345121470011e-05 6.43615396478370e-05 2.46142329720490e-05 -3.87846635607889e-05 -6.91076702758301e-05 -3.79849153633203e-05 2.83789147090148e-05 7.14299884465701e-05 5.20534480851763e-05 -1.39091607035773e-05 -6.86407496124578e-05 -6.32319028816962e-05 -1.63588205000798e-06 6.18719578035014e-05 7.04126720438485e-05 1.55068668367708e-05 -5.43669346667406e-05 -7.62447582511926e-05 -2.91027905334664e-05 4.62018932336274e-05 8.22506277236365e-05 4.51635490089979e-05 -3.39913804959379e-05 -8.54242756108462e-05 -6.23142606645353e-05 1.66012863107661e-05 8.22451715478654e-05 7.59304381564853e-05 2.14940664783044e-06 -7.41436519239985e-05 -8.45736532421024e-05 -1.87010537492825e-05 6.53539806969532e-05 9.17508374429416e-05 3.49399728598577e-05 -5.59697817267441e-05 -9.95340616918303e-05 -5.45876518388260e-05 4.14484528823616e-05 0.000103973587529008 7.59376212956481e-05 -2.01579830736330e-05 -0.000100335519008912 -9.28771447117423e-05 -2.90248686299073e-06 9.04644421274783e-05 0.000103480416426022 2.29943759708254e-05 -8.00423575819017e-05 -0.000112517436862383 -4.27248635530566e-05 6.91977585085310e-05 0.000122899586598638 6.73016589461448e-05 -5.16560971873144e-05 -0.000129292827355920 -9.45710544202943e-05 2.49933839538005e-05 0.000125125419141815 0.000116202199000800 4.05283841724518e-06 -0.000112833480841652 -0.000129517882481023 -2.89557319373827e-05 0.000100302633476073 0.000141224175631004 5.34296707084103e-05 -8.77363207880244e-05 -0.000155576700532978 -8.50362548961274e-05 6.61527416003481e-05 0.000165127242713013 0.000121010273935647 -3.18029250912041e-05 -0.000160384106883791 -0.000149559953944593 -5.90118519262908e-06 0.000144655343854179 0.000166782174568324 3.75760905264101e-05 -0.000129355810069141 -0.000182502707054023 -6.87170038827082e-05 0.000114861425079719 0.000203263045523929 0.000110830252464308 -8.77231085872275e-05 -0.000218221891309246 -0.000160312756068591 4.18281967542032e-05 0.000212960217830995 0.000199653019141310 9.06865895414234e-06 -0.000192116892114472 -0.000222797912967484 -5.07087366387324e-05 0.000173137776554082 0.000244929836818115 9.16217520405334e-05 -0.000156828308691598 -0.000276791242861281 -0.000150425111398925 0.000121837623646090 0.000301745746772299 0.000222410187273028 -5.74659910757291e-05 -0.000296381882733296 -0.000279883710243700 -1.49778811072128e-05 0.000267439720600430 0.000312644289659533 7.21559176252220e-05 -0.000243592109870459 -0.000345873084896041 -0.000128165258252519 0.000226831517188859 0.000398884623171019 0.000215761502624201 -0.000180478527894365 -0.000444324772466521 -0.000329063025614480 8.38470030126053e-05 0.000440534003890987 0.000420353438156364 2.73744349235008e-05 -0.000397618829670162 -0.000470301960020444 -0.000110767779899594 0.000367776322745596 0.000525026181634289 0.000191684616140766 -0.000356809123003002 -0.000624137116255830 -0.000335168958234279 0.000294221194089930 0.000718305880366498 0.000535902641715008 -0.000133654423688371 -0.000722773839568612 -0.000700867351206092 -5.82985218480688e-05 0.000652486985514208 0.000786363923515116 0.000191295145494676 -0.000618349201978860 -0.000890391995021146 -0.000316539562007856 0.000641609148619907 0.00111297178073592 0.000590216175513928 -0.000561463286485931 -0.00135368539080451 -0.00102308686145593 0.000245815681766296 0.00139899846890962 0.00139572858799842 0.000160762590550744 -0.00126256426236947 -0.00157567349906282 -0.000406874277518155 0.00125043949733502 0.00182970662713136 0.000612030076248452 -0.00147831574995496 -0.00252626928008312 -0.00130391536655013 0.00145721816095607 0.00344489592556457 0.00267951320857504 -0.000593540612723635 -0.00379176153404114 -0.00403299098665448 -0.000757880784024924 0.00340953344282384 0.00464841716043338 0.00139157841134363 -0.00375131849200507 -0.00571521635248127 -0.00146651477442349 0.00640157544211263 0.0106103309763491 0.00496402867616452 -0.00914821340578120 -0.0213465773165326 -0.0187565924600253 0.00301086965363439 0.0326480764938372 0.0470515615109690 0.0265258274408728 -0.0274976658180988 -0.0851488284541620 -0.0993586985699352 -0.0321185822381139 0.118930930763539 0.310898747357599 0.471582724235630 0.534155015429101 0.471582724235630 0.310898747357599 0.118930930763539 -0.0321185822381139 -0.0993586985699352 -0.0851488284541620 -0.0274976658180988 0.0265258274408728 0.0470515615109690 0.0326480764938372 0.00301086965363439 -0.0187565924600253 -0.0213465773165326 -0.00914821340578120 0.00496402867616452 0.0106103309763491 0.00640157544211263 -0.00146651477442349 -0.00571521635248127 -0.00375131849200507 0.00139157841134363 0.00464841716043338 0.00340953344282384 -0.000757880784024924 -0.00403299098665448 -0.00379176153404114 -0.000593540612723635 0.00267951320857504 0.00344489592556457 0.00145721816095607 -0.00130391536655013 -0.00252626928008312 -0.00147831574995496 0.000612030076248452 0.00182970662713136 0.00125043949733502 -0.000406874277518155 -0.00157567349906282 -0.00126256426236947 0.000160762590550744 0.00139572858799842 0.00139899846890962 0.000245815681766296 -0.00102308686145593 -0.00135368539080451 -0.000561463286485931 0.000590216175513928 0.00111297178073592 0.000641609148619907 -0.000316539562007856 -0.000890391995021146 -0.000618349201978860 0.000191295145494676 0.000786363923515116 0.000652486985514208 -5.82985218480688e-05 -0.000700867351206092 -0.000722773839568612 -0.000133654423688371 0.000535902641715008 0.000718305880366498 0.000294221194089930 -0.000335168958234279 -0.000624137116255830 -0.000356809123003002 0.000191684616140766 0.000525026181634289 0.000367776322745596 -0.000110767779899594 -0.000470301960020444 -0.000397618829670162 2.73744349235008e-05 0.000420353438156364 0.000440534003890987 8.38470030126053e-05 -0.000329063025614480 -0.000444324772466521 -0.000180478527894365 0.000215761502624201 0.000398884623171019 0.000226831517188859 -0.000128165258252519 -0.000345873084896041 -0.000243592109870459 7.21559176252220e-05 0.000312644289659533 0.000267439720600430 -1.49778811072128e-05 -0.000279883710243700 -0.000296381882733296 -5.74659910757291e-05 0.000222410187273028 0.000301745746772299 0.000121837623646090 -0.000150425111398925 -0.000276791242861281 -0.000156828308691598 9.16217520405334e-05 0.000244929836818115 0.000173137776554082 -5.07087366387324e-05 -0.000222797912967484 -0.000192116892114472 9.06865895414234e-06 0.000199653019141310 0.000212960217830995 4.18281967542032e-05 -0.000160312756068591 -0.000218221891309246 -8.77231085872275e-05 0.000110830252464308 0.000203263045523929 0.000114861425079719 -6.87170038827082e-05 -0.000182502707054023 -0.000129355810069141 3.75760905264101e-05 0.000166782174568324 0.000144655343854179 -5.90118519262908e-06 -0.000149559953944593 -0.000160384106883791 -3.18029250912041e-05 0.000121010273935647 0.000165127242713013 6.61527416003481e-05 -8.50362548961274e-05 -0.000155576700532978 -8.77363207880244e-05 5.34296707084103e-05 0.000141224175631004 0.000100302633476073 -2.89557319373827e-05 -0.000129517882481023 -0.000112833480841652 4.05283841724518e-06 0.000116202199000800 0.000125125419141815 2.49933839538005e-05 -9.45710544202943e-05 -0.000129292827355920 -5.16560971873144e-05 6.73016589461448e-05 0.000122899586598638 6.91977585085310e-05 -4.27248635530566e-05 -0.000112517436862383 -8.00423575819017e-05 2.29943759708254e-05 0.000103480416426022 9.04644421274783e-05 -2.90248686299073e-06 -9.28771447117423e-05 -0.000100335519008912 -2.01579830736330e-05 7.59376212956481e-05 0.000103973587529008 4.14484528823616e-05 -5.45876518388260e-05 -9.95340616918303e-05 -5.59697817267441e-05 3.49399728598577e-05 9.17508374429416e-05 6.53539806969532e-05 -1.87010537492825e-05 -8.45736532421024e-05 -7.41436519239985e-05 2.14940664783044e-06 7.59304381564853e-05 8.22451715478654e-05 1.66012863107661e-05 -6.23142606645353e-05 -8.54242756108462e-05 -3.39913804959379e-05 4.51635490089979e-05 8.22506277236365e-05 4.62018932336274e-05 -2.91027905334664e-05 -7.62447582511926e-05 -5.43669346667406e-05 1.55068668367708e-05 7.04126720438485e-05 6.18719578035014e-05 -1.63588205000798e-06 -6.32319028816962e-05 -6.86407496124578e-05 -1.39091607035773e-05 5.20534480851763e-05 7.14299884465701e-05 2.83789147090148e-05 -3.79849153633203e-05 -6.91076702758301e-05 -3.87846635607889e-05 2.46142329720490e-05 6.43615396478370e-05 4.59345121470011e-05 -1.30662921240797e-05 -5.95323428536631e-05 -5.24128095649087e-05 1.27374921684735e-06]);
% отладочный фильтр:
%rcTxFilt = [0.000127307926716046 7.11343383962075e-05 -4.93503663307394e-05 -0.000127572345617079 -9.28996904374394e-05 2.59249029639029e-05 0.000124349098933678 0.000113500885226910 -2.98858257610381e-18 -0.000117198745339931 -0.000132572156494522 -2.85323634834813e-05 0.000105519907843693 0.000149496072489388 5.96399178085255e-05 -8.86111779766842e-05 -0.000163375760092382 -9.30520185865721e-05 6.57600543594153e-05 0.000173039079598023 0.000128171403934420 -3.63531858712953e-05 -0.000177078038880773 -0.000164005478155541 -7.96609804627414e-19 0.000173924129395671 0.000199126020964455 4.33399468617076e-05 -0.000161957449708649 -0.000231664740712553 -9.32367186059709e-05 0.000139644634293252 0.000259349979001700 0.000148688134093589 -0.000105697914948190 -0.000279587239575253 -0.000208047275750569 5.92452963837515e-05 0.000289583201376720 0.000268989277353000 3.27943825819145e-19 -0.000286509659528972 -0.000328525452434203 -7.15838300371958e-05 0.000267700615019214 0.000383070293672727 0.000154182541669679 -0.000230872710275983 -0.000428563774861127 -0.000245514416515254 0.000174356587683871 0.000460647880935457 0.000342302687946396 -9.73247210947925e-05 -0.000474892571264218 -0.000440299479697762 1.06809042430346e-18 0.000467062662948145 0.000534377034535586 0.000116171041342696 -0.000433413631296167 -0.000618688990599287 -0.000248395881433867 0.000371001289161959 0.000686900389461988 0.000392478519950096 -0.000277987935739063 -0.000732480776805741 -0.000542838271376002 0.000153926041264484 0.000749050421528378 0.000692612871726240 -4.19173102936800e-18 -0.000730765582860864 -0.000833849784163428 -0.000180792966309231 0.000672725147865656 0.000957784901798150 0.000383540001446889 -0.000571378078962210 -0.00105520284384732 -0.000601402383454935 0.000424909159758703 0.00111686798502829 0.000825708570539895 -0.000233579672988602 -0.00113401052431660 -0.00104615658499266 1.01089427573543e-17 0.00109884756651484 0.00125112649474289 0.000270687250487884 -0.00100511562358634 -0.00142809803890484 -0.000570732109498858 0.000848588379142297 0.00156416260172266 0.000889824601924007 -0.000627552193239643 -0.00164661307312541 -0.00121527402677616 0.000343211795670153 0.00166358995386471 0.00153232374316395 -2.03301673503722e-17 -0.00160475766884945 -0.00182459863822964 -0.000394231927096577 0.00146198171747728 0.00207467581149363 0.000828162454663276 -0.00122997524695351 -0.00226476246286004 -0.00128710038749605 0.000906883061963143 0.00237745886410342 0.00175324537110245 -0.000494772095178322 -0.00239657896674385 -0.00220610870629176 -1.33275696251241e-18 0.00230799697298863 0.00262308737668324 0.000566562242488510 -0.00210048535552491 -0.00298017662928807 -0.00118947209044143 0.00176650859317114 0.00325279919085563 0.00184883292991545 -0.00130293747321806 -0.00341672261686374 -0.00252059049314118 0.000711651319021428 0.00344903070198461 0.00317700242594218 -9.57952974943380e-18 -0.00332911063882064 -0.00378726564052645 -0.000818895901150503 0.00303961494956287 0.00431827612547547 0.00172601983159042 -0.00256735631832069 -0.00473548565404884 -0.00269651132216939 0.00190409442595588 0.00500380925997156 0.00369988476036858 -0.00104717675315641 -0.00508852602622126 -0.00470038844472045 3.12814679075274e-17 0.00495610266140209 0.00565745763701417 0.00122773488858265 -0.00457485248664175 -0.00652618915704608 -0.00261999334520789 0.00391531788694281 0.00725772796833431 0.00415461384762432 -0.00295022441815394 -0.00779939908250794 -0.00580375144811501 0.00165378473075978 0.00809432260907337 0.00753454909417643 -1.14872101547788e-17 -0.00808007757041787 -0.00931001791718449 -0.00204064903465282 0.00768564728590526 0.0110900984907345 0.00450725658616147 -0.00682519069200838 -0.0128328668876497 -0.00745958251258403 0.00538565211255178 0.0144958425796457 0.0109991976323519 -0.00320151157796350 -0.0160373501535973 -0.0153127785530762 1.20042275838879e-17 0.0174178837161771 0.0207703911717145 0.00473060941697592 -0.0186014218900517 -0.0281832895210067 -0.0121106807589561 0.0195566425395770 0.0396394220761058 0.0251900048384158 -0.0202579897716814 -0.0623423416734472 -0.0562116165073740 0.0206865512084362 0.146988113509521 0.264616663575341 0.312460661964749 0.264616663575341 0.146988113509521 0.0206865512084362 -0.0562116165073740 -0.0623423416734472 -0.0202579897716814 0.0251900048384158 0.0396394220761058 0.0195566425395770 -0.0121106807589561 -0.0281832895210067 -0.0186014218900517 0.00473060941697592 0.0207703911717145 0.0174178837161771 1.20042275838879e-17 -0.0153127785530762 -0.0160373501535973 -0.00320151157796350 0.0109991976323519 0.0144958425796457 0.00538565211255178 -0.00745958251258403 -0.0128328668876497 -0.00682519069200838 0.00450725658616147 0.0110900984907345 0.00768564728590526 -0.00204064903465282 -0.00931001791718449 -0.00808007757041787 -1.14872101547788e-17 0.00753454909417643 0.00809432260907337 0.00165378473075978 -0.00580375144811501 -0.00779939908250794 -0.00295022441815394 0.00415461384762432 0.00725772796833431 0.00391531788694281 -0.00261999334520789 -0.00652618915704608 -0.00457485248664175 0.00122773488858265 0.00565745763701417 0.00495610266140209 3.12814679075274e-17 -0.00470038844472045 -0.00508852602622126 -0.00104717675315641 0.00369988476036858 0.00500380925997156 0.00190409442595588 -0.00269651132216939 -0.00473548565404884 -0.00256735631832069 0.00172601983159042 0.00431827612547547 0.00303961494956287 -0.000818895901150503 -0.00378726564052645 -0.00332911063882064 -9.57952974943380e-18 0.00317700242594218 0.00344903070198461 0.000711651319021428 -0.00252059049314118 -0.00341672261686374 -0.00130293747321806 0.00184883292991545 0.00325279919085563 0.00176650859317114 -0.00118947209044143 -0.00298017662928807 -0.00210048535552491 0.000566562242488510 0.00262308737668324 0.00230799697298863 -1.33275696251241e-18 -0.00220610870629176 -0.00239657896674385 -0.000494772095178322 0.00175324537110245 0.00237745886410342 0.000906883061963143 -0.00128710038749605 -0.00226476246286004 -0.00122997524695351 0.000828162454663276 0.00207467581149363 0.00146198171747728 -0.000394231927096577 -0.00182459863822964 -0.00160475766884945 -2.03301673503722e-17 0.00153232374316395 0.00166358995386471 0.000343211795670153 -0.00121527402677616 -0.00164661307312541 -0.000627552193239643 0.000889824601924007 0.00156416260172266 0.000848588379142297 -0.000570732109498858 -0.00142809803890484 -0.00100511562358634 0.000270687250487884 0.00125112649474289 0.00109884756651484 1.01089427573543e-17 -0.00104615658499266 -0.00113401052431660 -0.000233579672988602 0.000825708570539895 0.00111686798502829 0.000424909159758703 -0.000601402383454935 -0.00105520284384732 -0.000571378078962210 0.000383540001446889 0.000957784901798150 0.000672725147865656 -0.000180792966309231 -0.000833849784163428 -0.000730765582860864 -4.19173102936800e-18 0.000692612871726240 0.000749050421528378 0.000153926041264484 -0.000542838271376002 -0.000732480776805741 -0.000277987935739063 0.000392478519950096 0.000686900389461988 0.000371001289161959 -0.000248395881433867 -0.000618688990599287 -0.000433413631296167 0.000116171041342696 0.000534377034535586 0.000467062662948145 1.06809042430346e-18 -0.000440299479697762 -0.000474892571264218 -9.73247210947925e-05 0.000342302687946396 0.000460647880935457 0.000174356587683871 -0.000245514416515254 -0.000428563774861127 -0.000230872710275983 0.000154182541669679 0.000383070293672727 0.000267700615019214 -7.15838300371958e-05 -0.000328525452434203 -0.000286509659528972 3.27943825819145e-19 0.000268989277353000 0.000289583201376720 5.92452963837515e-05 -0.000208047275750569 -0.000279587239575253 -0.000105697914948190 0.000148688134093589 0.000259349979001700 0.000139644634293252 -9.32367186059709e-05 -0.000231664740712553 -0.000161957449708649 4.33399468617076e-05 0.000199126020964455 0.000173924129395671 -7.96609804627414e-19 -0.000164005478155541 -0.000177078038880773 -3.63531858712953e-05 0.000128171403934420 0.000173039079598023 6.57600543594153e-05 -9.30520185865721e-05 -0.000163375760092382 -8.86111779766842e-05 5.96399178085255e-05 0.000149496072489388 0.000105519907843693 -2.85323634834813e-05 -0.000132572156494522 -0.000117198745339931 -2.98858257610381e-18 0.000113500885226910 0.000124349098933678 2.59249029639029e-05 -9.28996904374394e-05 -0.000127572345617079 -4.93503663307394e-05 7.11343383962075e-05 0.000127307926716046];
h1 = dfilt.dffir(rcTxFilt);
clear rcTxFilt
D2 = mean(grpdelay(h1));
Im_filterred = double(filter(h1,[Im; zeros(D2,1)]));
%clear Im

Re_filterred = double(filter(h1,[Re; zeros(D2,1)]));
%clear Re
%clear h1
%clear D2

%Re_filterred = step(H,[real(Re); zeros(Nsym/2,1)]);
%Im_filterred = step(H,[real(Im); zeros(Nsym/2,1)]);
%low_pass = [-0.000470907430743493 -0.000437361347039994 2.99136922198555e-18 0.000496775918377593 0.000604321045950798 0.000141581535126709 -0.000574940879334697 -0.000899403594177566 -0.000397365931592921 0.000654456449409570 0.00133680239930951 0.000842108570651388 -0.000656628715761547 -0.00190092069484592 -0.00154419240920160 0.000478760202198848 0.00254081977393069 0.00255562183766106 -4.19563952769886e-18 -0.00316711471774318 -0.00390315727329128 -0.000912099605650995 0.00365086752986672 0.00558174141445071 0.00239654898677380 -0.00382289997191380 -0.00755113816809724 -0.00459897088519919 0.00346998079334781 0.00973635477146274 0.00768305098760068 -0.00232025188160185 -0.0120319869249529 -0.0118666579858930 9.58846199622488e-18 0.0143101670475314 0.0175163906929742 0.00408699092063409 -0.0164313628286625 -0.0254056777055936 -0.0111200079771985 0.0182569204633219 0.0375550605748005 0.0241768195041314 -0.0196620185798643 -0.0610822033898605 -0.0555012952754185 0.0205476243989697 0.146624793031549 0.264638000398036 0.312752009851146 0.264638000398036 0.146624793031549 0.0205476243989697 -0.0555012952754185 -0.0610822033898605 -0.0196620185798643 0.0241768195041314 0.0375550605748005 0.0182569204633219 -0.0111200079771985 -0.0254056777055936 -0.0164313628286625 0.00408699092063409 0.0175163906929742 0.0143101670475314 9.58846199622488e-18 -0.0118666579858930 -0.0120319869249529 -0.00232025188160185 0.00768305098760068 0.00973635477146274 0.00346998079334781 -0.00459897088519919 -0.00755113816809724 -0.00382289997191380 0.00239654898677380 0.00558174141445071 0.00365086752986672 -0.000912099605650995 -0.00390315727329128 -0.00316711471774318 -4.19563952769886e-18 0.00255562183766106 0.00254081977393069 0.000478760202198848 -0.00154419240920160 -0.00190092069484592 -0.000656628715761547 0.000842108570651388 0.00133680239930951 0.000654456449409570 -0.000397365931592921 -0.000899403594177566 -0.000574940879334697 0.000141581535126709 0.000604321045950798 0.000496775918377593 2.99136922198555e-18 -0.000437361347039994 -0.000470907430743493];
%h1 = dfilt.dffir(low_pass);
%clear rcTxFilt
%D2 = mean(grpdelay(h1));
%Im_filterred = double(filter(h1,[Im; zeros(D2,1)]));
%Re_filterred = double(filter(h1,[Re; zeros(D2,1)]));
%clear Im
%{
Nsym = 16;           % Filter span in symbol durations
beta = 0.2;         % Roll-off factor
sampsPerSym = 8;    % Upsampling factor

H = comm.RaisedCosineTransmitFilter('FilterSpanInSymbols',Nsym,'OutputSamplesPerSymbol',sampsPerSym)

b = coeffs(H);
%H.Gain = 1/max(b.Numerator);

Im_filterred = step(H,[Im; zeros(Nsym/2,1)]);

Re_filterred = step(H,[Re; zeros(Nsym/2,1)]);
%}

%Re_filterred = Re;
%Im_filterred = Im;
% Sampling period


T = 1/Fs;
L = size(Im_filterred,1);            % Length of signal
t = double((0:L-1)*T);
t = t';% Time vector

f = 12000; %carrier frequency

I = 0.7*cos(2*pi*(f)*t);

Q = 0.7*sin(2*pi*(f)*t);

%clear t;

out_I = Re_filterred.*I;
%clear I
%clear Re_filterred

out_Q = Im_filterred.*Q;
%clear Q
%clear Im_filterred
out = out_I + out_Q;

%clear out_I
%clear out_Q
%out = [zeros(48000,1);out];
%plot(out)
var = 1/(10^(EsNodB/10));
%out = out(D2+1:end);
noise = sqrt(var)*randn(size(out));

%out = out+noise;
%clear noise
out = out+ noise;
%psd(out)
