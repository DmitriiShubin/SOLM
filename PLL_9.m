%recieved
%out

%œŒÃ≈Õﬂ“‹ Õ¿ RECIEVED
out1 = recieved(size(recieved,1)*0.25:size(recieved,1)*0.75);
L = size(out1,1); % Length of recieved signal         
t = (0:L-1)*T;
t = double(t');% Time vector


PLL_I = out1.*cos(2*pi*(f)*t);

low_pass = [-0.000470907430743493 -0.000437361347039994 2.99136922198555e-18 0.000496775918377593 0.000604321045950798 0.000141581535126709 -0.000574940879334697 -0.000899403594177566 -0.000397365931592921 0.000654456449409570 0.00133680239930951 0.000842108570651388 -0.000656628715761547 -0.00190092069484592 -0.00154419240920160 0.000478760202198848 0.00254081977393069 0.00255562183766106 -4.19563952769886e-18 -0.00316711471774318 -0.00390315727329128 -0.000912099605650995 0.00365086752986672 0.00558174141445071 0.00239654898677380 -0.00382289997191380 -0.00755113816809724 -0.00459897088519919 0.00346998079334781 0.00973635477146274 0.00768305098760068 -0.00232025188160185 -0.0120319869249529 -0.0118666579858930 9.58846199622488e-18 0.0143101670475314 0.0175163906929742 0.00408699092063409 -0.0164313628286625 -0.0254056777055936 -0.0111200079771985 0.0182569204633219 0.0375550605748005 0.0241768195041314 -0.0196620185798643 -0.0610822033898605 -0.0555012952754185 0.0205476243989697 0.146624793031549 0.264638000398036 0.312752009851146 0.264638000398036 0.146624793031549 0.0205476243989697 -0.0555012952754185 -0.0610822033898605 -0.0196620185798643 0.0241768195041314 0.0375550605748005 0.0182569204633219 -0.0111200079771985 -0.0254056777055936 -0.0164313628286625 0.00408699092063409 0.0175163906929742 0.0143101670475314 9.58846199622488e-18 -0.0118666579858930 -0.0120319869249529 -0.00232025188160185 0.00768305098760068 0.00973635477146274 0.00346998079334781 -0.00459897088519919 -0.00755113816809724 -0.00382289997191380 0.00239654898677380 0.00558174141445071 0.00365086752986672 -0.000912099605650995 -0.00390315727329128 -0.00316711471774318 -4.19563952769886e-18 0.00255562183766106 0.00254081977393069 0.000478760202198848 -0.00154419240920160 -0.00190092069484592 -0.000656628715761547 0.000842108570651388 0.00133680239930951 0.000654456449409570 -0.000397365931592921 -0.000899403594177566 -0.000574940879334697 0.000141581535126709 0.000604321045950798 0.000496775918377593 2.99136922198555e-18 -0.000437361347039994 -0.000470907430743493];
h2 = dfilt.dffir(low_pass);
clear low_pass
D3 = mean(grpdelay(h2));

PLL_I_filterred = double(filter(h2,[PLL_I; zeros(D3,1)]));
clear PLL_I


PLL_Q = out1.*sin(2*pi*(f)*t);

PLL_Q_filterred = double(filter(h2,[PLL_Q; zeros(D3,1)]));
clear PLL_Q


PLL_received = PLL_I_filterred + 1i*PLL_Q_filterred;
clear PLL_I_filterred
clear PLL_Q_filterred

phase = angle(PLL_received(48000:end));
clear PLL_received
proiz = diff(unwrap(phase));
clear phase
m = mean(proiz);
clear proiz

Freq_pll = m*48000/6.28;





PLL_I = out1.*cos(2*pi*(f-Freq_pll)*t);

low_pass = [-0.000470907430743493 -0.000437361347039994 2.99136922198555e-18 0.000496775918377593 0.000604321045950798 0.000141581535126709 -0.000574940879334697 -0.000899403594177566 -0.000397365931592921 0.000654456449409570 0.00133680239930951 0.000842108570651388 -0.000656628715761547 -0.00190092069484592 -0.00154419240920160 0.000478760202198848 0.00254081977393069 0.00255562183766106 -4.19563952769886e-18 -0.00316711471774318 -0.00390315727329128 -0.000912099605650995 0.00365086752986672 0.00558174141445071 0.00239654898677380 -0.00382289997191380 -0.00755113816809724 -0.00459897088519919 0.00346998079334781 0.00973635477146274 0.00768305098760068 -0.00232025188160185 -0.0120319869249529 -0.0118666579858930 9.58846199622488e-18 0.0143101670475314 0.0175163906929742 0.00408699092063409 -0.0164313628286625 -0.0254056777055936 -0.0111200079771985 0.0182569204633219 0.0375550605748005 0.0241768195041314 -0.0196620185798643 -0.0610822033898605 -0.0555012952754185 0.0205476243989697 0.146624793031549 0.264638000398036 0.312752009851146 0.264638000398036 0.146624793031549 0.0205476243989697 -0.0555012952754185 -0.0610822033898605 -0.0196620185798643 0.0241768195041314 0.0375550605748005 0.0182569204633219 -0.0111200079771985 -0.0254056777055936 -0.0164313628286625 0.00408699092063409 0.0175163906929742 0.0143101670475314 9.58846199622488e-18 -0.0118666579858930 -0.0120319869249529 -0.00232025188160185 0.00768305098760068 0.00973635477146274 0.00346998079334781 -0.00459897088519919 -0.00755113816809724 -0.00382289997191380 0.00239654898677380 0.00558174141445071 0.00365086752986672 -0.000912099605650995 -0.00390315727329128 -0.00316711471774318 -4.19563952769886e-18 0.00255562183766106 0.00254081977393069 0.000478760202198848 -0.00154419240920160 -0.00190092069484592 -0.000656628715761547 0.000842108570651388 0.00133680239930951 0.000654456449409570 -0.000397365931592921 -0.000899403594177566 -0.000574940879334697 0.000141581535126709 0.000604321045950798 0.000496775918377593 2.99136922198555e-18 -0.000437361347039994 -0.000470907430743493];
h2 = dfilt.dffir(low_pass);
clear low_pass
D3 = mean(grpdelay(h2));

PLL_I_filterred = double(filter(h2,[PLL_I; zeros(D3,1)]));
clear PLL_I


PLL_Q = out1.*sin(2*pi*(f-Freq_pll)*t);
clear t

PLL_Q_filterred = double(filter(h2,[PLL_Q; zeros(D3,1)]));
clear PLL_Q
clear out1

PLL_received = PLL_I_filterred + 1i*PLL_Q_filterred;
clear PLL_I_filterred
clear PLL_Q_filterred

phase = angle(PLL_received(48000:end));
clear PLL_received
proiz = diff(unwrap(phase));
clear phase
m = mean(proiz);
clear proiz

Freq_pll_1 = m*48000/6.28 + Freq_pll;

